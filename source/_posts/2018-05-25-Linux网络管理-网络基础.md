---
title: 【Linux】Linux网络管理01 网络基础
tags: Linux
abbrlink: 408bec44
date: 2018-05-01 19:02:32
---



## OSI模型
开放系统互联模型，由ISO(国际标准化组织) 组织开发的



该模型为基础模型, 而实际中常用的TCP/IP模型是由七层模型演变的



上三层(应用层、表示层、会话层)是对用户提供服务, 下四层(传输层、网络层、数据链路层、物理层)对数据传输提供服务
<style>
table th:nth-of-type(1){
width: 10%;
}
table th:nth-of-type(2){
width: 70%
;
}
table th:nth-of-type(3){
width: 20%;
}

</style>
 

每一层的变化不影响其他层

| 层级       | 作用                                                                                                                                                                                                        | 传输单元               |
| ---------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------- |
| 应用层     | 用户接口，所有能产生网络流量的程序                                                                                                                                                                                                    | APDU，应用协议数据单元 |
| 表示层     | 数据的表现形式/编码方式（ASCII、GB2312、jpg），在传输之前是否进行 **加密**、**压缩**      乱码                                                                                                                                     | PPDU，表示协议数据单元 |
| 会话层     | 对应用会话的管理、同步。 确定网络数据是否要经过远程会话                                                                        `netstat`命令 可以查看木马                                                                            | SPDU，会话协议数据单元 |
| 传输层     | 确定可靠与不可靠的传输（ TCP传输控制协议可靠不会丢、UDP用户数据报协议更快但可能会丢(一个包可以解决的问题，比如查询DNS，QQ聊天)）、传输前的错误检测、 流量控制（你发太快啦，慢点）、 确立端口号, 便于通过IP确定主机后, 通过端口确定交互的服务                               | TPDU，传输协议数据单元 |
| 网络层     | 负责提供逻辑地址(IP地址, 需要写入发件人IP与收件人IP）、 负责选择最佳路径，规划IP地址。 （确定IP地址，原IP、目地IP）       ，IP4，IP6                                                                                                      | 报文                   |
| 数据链路层 | 负责组成帧(组入MAC信息)，用MAC地址访问媒介（源地址&目的地址）、错误的检测与修正。物理地址，就是计算机MAC地址，也就是计算机网卡地址。每一台电脑都有一个网卡地址，MAC地址负责局域网通信，IP地址负责外网通信。帧的开始和结束，透明传输（帧的转义字符的增加删除），差错校验（只检验，不纠正，纠正由传输层完成，或丢掉或重新传输） | 帧                     |
| 物理层     | 设备之间比特流的传输（ 最基本的数据传递）、物理接口标准（ 网线口、视频口、音频口）、电气特性               ，物理介质，如何在物理层上传输更快的速度                                                     | 比特流                 |



举例场景 用户A需要给用户B发送一份邮件

1. 应用层 : 浏览器进入邮箱, 写邮件, 点击发送, 数据将传递至 表示层
2. 表示层 : 进行的数据的编码, 而后数据传递至会话层
3. 会话层 : 判断数据的发送类型, 是进行网络传输还是进行本地保存, 若是进行传输 传递至传输层
4. 传输层 : 确立协议TCP或UDP, 写入邮件的发送及目标端口号, 传递至网络层
5. 网络层 : 写入自身及目标IP地址, 传递至数据链路层
6. 数据链路层 : 写入源MAC地址与目标MAC地址, 由于IP地址找到局域网, 再通过MAC地址在局域网中找到目标, 传递至物理层
7. 物理层 : 数据传输

### OSI参考模型和故障排除
故障从下到上进行排除，因为越上层越复杂
1. 物理层故障：查看发送和接收的数据包大小是否一致
2. 数据链路层故障：mac冲突、ADSL过期、网速没办法协商一致（100M和1G）、计算机连接到错误的WLAN
3. 网络层故障：配置错误的IP地址、子网掩码、网关，路由器没有配置到达的目标网络的路由
4. 应用层故障（应用层、表现层、会话层、传输层）：应用程序配置错误


### OSI参考模型和网络安全
1. 物理层安全：别人可以接入你的网络
2. 数据链路层安全：ASDL账号密码、无线AP、VLAN、交换机商品绑定mac地址
3. 网络层安全：路由器上使用ACL控制数据包流量
4. 应用层安全（应用层、表现层、会话层、传输层）：开发的应用程序漏洞

<br />

## TCP/IP

### TCP/IP 四层模型与 OSI 七层模型对应关系

![](/img/IMG67.png)


* 应用层 : 应用层、表示层、会话层
为用户提供所需的各种服务, 例如 **FTP**、**Telnet**、**DNS**、**SMTP**等


* 传输层 : 传输层
负责为应用层实体提供端到端的通信功能, 保证了数据包的顺序传送及数据的完整性, 该层定义了两个主要的协议 : 传输控制协议(**TCP**)可靠的面向连接，不会丢失，类似打电话，网页、邮件 和  用户数据报协议(**UDP**)不可靠的面向无连接,有可能丢失, 类似发短信、QQ



*  网际互联层 : 网络层
主要解决主机到主机的通信问题, 它所包含的协议涉及数据包在整个网络上的逻辑传输, 该层有三个主要协议 : 网际协议(**IP**), 互联网组管理协议(**IGMP**), 互联网控制报文协议(**ICMP**)


* 网络接口层 : 数据链路层、物理层
负责监视数据在主机和网络之间的交换, 事实上, TCP/IP本身并未定义该层的协议, 而由参与互连的各网络使用自己的物理层和数据链路层协议, 然后与TCP/IP的网络接入层进行连接. 地址解析协议(**ARP**) 工作在此层, 即OSI参考模型的数据链路层.
地址解析协议(ARP) : 将IP地址 翻译成物理地址

### 数据封装过程
发送是由上至下进行打包, 接收是由下至上进行拆包
<!--![](/img/IMG9.jpg)-->
![](/img/IMG68.png)
![](/img/IMG69.png)
FCS：校验


### 数据解封装过程
计算机在接收到数据帧后，需要去掉为了传输而添加的附加信息，这称为解封装

![](/img/IMG70.png)


### TCP/IP  模型与OSI 模型的比较
共同点
1. OSI 参考模型和 TCP/IP参考模型都采用了层次结构的概念
2. 都能够提供面向连接和无连接两种通信服务机制






不同点

1. OSI 七层, TCP/IP 四层
2. 对可靠性要求不同(TCP/IP 更高)
3. OSI 模型是在协议开发前设计的, 具有通用性. TCP/IP 是先有协议集, 然后建立模型, 不适用与非TCP/IP网络
4. 实际市场应用不同( OSI 模型只是理论上的模型, 并没有成熟的产品, 而TCP/IP已经成为"实际上的国际标准")




<br />

## IP地址

### IP包头(如图)
横32位, 竖5行, 固定的共160位, 20字节, 另外有其他选项存在, 导致包头不固定, 因此每接收到包头, 需要进行检测包头长度才能够取出包头, 也是为何IPv4没有IPv6快的原因

包头中包含的IP地址只有32位, 即2的32次幂, 42亿9千万左右的IP

![](/img/IMG10.jpg)

### IP地址分类
IP分为A、B、C、D、E 五大类, 其中DE不对民用组织开放, 不可使用, 因此有效类只有ABC
可根据第一位数值判断类别, 1-126 为A类, 128-172 为B类, 192-223 为C类



127.0.0.1 为本机



 第一位表示不同网段, 不同网络, 不同网络之间的通信需要使用路由器，路由器是用来实现跨网络通信的, 同一网络下通信使用交换机即可. 第一位不变情况下, 后三位的变化都代表同一网络下的不同主机

1. A 类 : 每个网络中的第一个地址(X.0.0.0)代表网络本身,最后一个地址(X.255.255.255)代表当前网络的广播地址, 不能分配, 最大主机数 : 后三位的次幂, 减 第一和最后一个 , 2^24 -2
2.  B 类 : 前两位代表网段, 后两位代表网段中的不同主机
3. C 类 : 前三位代表网段, 最后一位代表不同主机





私有IP :  不需要花钱买, 用来做内网IP, 可有效保护公网IP, 不能直接访问公网, 需要与公网之间进行转换才可访问互联网

![](/img/IMG11.jpg)



<br />

## 子网掩码
ABC类可以用不同的网段个数和主机个数, 是由子网掩码决定
子网掩码用连续1的表示，例如255.0.0.0，255.255.0.0，255。255.255.255.0

子网掩码的作用：用来区分不同网段的IP----子网掩码与IP相与，得到的结果相同则在同一网段。否则不在，需要经过路由器转发。

合理的子网掩码 : 所有的1必须连续, A 类地址可匹配B类子网掩码

IP和子网掩码必须一起配合使用。
网络号=IP&&子网掩码

广播地址：主机号全为1,广播地址是专门用于同时向网络中所有工作站进行发送的一个地址

合理的子网掩码 : 所有的1必须连续, A 类地址可匹配B类子网掩码

![](/img/IMG12.png)



<br />

## 端口


![](/img/IMG13.jpg)
![](/img/IMG14.png)

```
netstat -an
# 查看本机启用的端口
#-a:查看所有连接和监听端口
#-n:显示IP地址和端口号，而不显示域名和服务名
```
TCP因为3次握手的机制所以需要监听，而UDP不需要监听



### 常见端口号
* FTP（文件传输协议）：20、21；
* SSH（安全shell协议）：22；
* telnet（远程登录协议）：23；
* DNS（域名系统）：53；
* http（超文本传输协议）：80；
* SMTP（简单邮件传输协议）：25；
* POP3（邮局协议）：110；


<br />

## DNS
### hosts和DNS
hosts文件：做静态IP和域名对应，优先于DNS.
位置：
C：\Windows\System32\drivers\etc\hosts
/etc/host
hosts文件只可做临时解析用，名称解析效能下降，主机维护困难

DNS全称为——>domain name system——>域名系统
* 不配置DNS是不能联网的。
* 在互联网中，通过IP地址来进行通信。
* IP地址是用数字来表示的，记忆起来太困难了(如116.213.120.232)
* 人对域名更加敏感，:http://www.imooc.com/

DNS服务的作用:将域名解析为IP地址
过程：客户机向DNS服务器发送查询IP请求
DNS服务器查询到web服务器的ip，告知用户
用户访问web服务器


### 域名空间结构
根域：.（13台服务器）
——>顶级域/一级域：包括组织域和地区域
（组织域：gov政府/edu教育部门/com商业部门/org民间团体/net网络服务机构/mil军事部门 地区域：cn 中国 hk 香港 jp 日本 Uk 英国 au 澳大利亚）
——>二级域：企业或个人自行购买的（imooc /microsoft/ibm/sina）
——>主机名/3级域：申请完二级域后自己定义的（www/news）

三级域（www）+二级域（baidu）+顶级域（.com）组成完整域名空间

为什么要进行域名分级划分
便于IP地址解析

### DNS查询过程

DNS客户机——>本地域名服务器——>根DNS服务器——>cn服务器——>com.cn服务器——>imooc.com.cn——>本地域名服务器——>DNS客户机——>web服务器www.imooc.com.cn

![](/img/IMG15.png)

### DNS查询类型
从查询方式上分
* 递归查询：客户机将请求发送给DNS服务器，服务器通过缓存或者询问其他服务器最后将一个准确的结果或者失败回复给客户机，客户机只负责问，所有事情都是服务器做。客户机对本地域名服务器查询的机制，必须反馈准确值（要么成功要么失败）
* 迭代查询：客户机像DNS服务器发送请求后，服务器向客户机返回另一个服务器的地址，客户机不停地向不同DNS服务器发送请求，所有事情都自己做。本地域名服务器分别对各级域名服务器的查询机制，不一定反馈准确值




从查询内容上分
* 正向：域名到IP ARP 
* 反向：IP到域名 RARP




<br />

## 网关

* 网关（Gateway）又称网间连接器、协议转换器
* 网关在网络层以上实现网络互连，是最复杂的网络互连设备，仅用于两个高层不同的网络互连
* 网关既可以用于广域网互连，也可以用于局域网互连
* 网关是一种充当转换重任的服务器或路由器
* 交换机不能识别ip，只能记录客户机的MAC地址。即只能在局域网中进行通信
* 访问不同网段，则需要引入网关。
* 网关：一个具有路由功能的设备，一般为路由器。

![](/img/IMG16.jpg)


### 网关作用
*  网关在所有内网计算机访问的不是本网段的数据包时使用
* 把内网Ip转公网Ip，公网Ip转内网Ip






---
title: VIM常用按键
tags: VIM
abbrlink: e15257f3
date: 2018-05-26 04:57:06
---


最近看了黑马的Python基础教程，里面有讲`vim`，讲得很仔细，索性再按照讲的笔记再整理一下之前写的

在终端输入`vimtutor`命令可以打开vim的教程，输入`:q`退出



## vi和ivm
在很多Linux发行版中，直接把`vi`做成`vim`的软连接

```
# 查找 vi 的运行文件
which vi
ls -l /usr/bin/vi
ls -l /etc/alternatives/vi
ls -l /usr/bin/vim.basic

# 查找 vim 的运行文件
which vim
ls -l /usr/bin/vim
ls -l /etc/alternatives/vim
ls -l /usr/bin/vim.basic
```


### vi
`vi` 是`Visual interface`的简称，是Linux中最经典的文本编辑器
`vi` 的核心设计思想————让程序员的手指始终保持在键盘的核心区域，就能完成所有的编辑操作

`vi` 的特点：
- 没有图形界面的、功能强大的编辑器
- 只能是编辑文本内容，不能对字体、段落进行排版
- 不支持鼠标操作
- 没有菜单
- 只有命令

### vim
vim = vi improved
`vim` 是从 `vi` 发展出来的一个文本编辑器，支持代码补全、编译及错误跳转等方便编程的功能特别丰富，在程序员中被广泛使用，被称为编辑器之神（Emacs是神的编辑器）

```
yum install vim
apt install vim
```
<br>


## 打开和新建文件
在终端中输入`vim`在后面跟上文件名即可
```
vim 文件名
```
- 如果文件已经存在，会直接打开该文件
- 如果文件不存在，会新建一个文件

### 打开文件并且定位行

在日常工作中，有可能会遇到“打开一个文件，并定位到指定行”的情况，例如：在开发时，知道某一行代码有错误，可以快速定位到出错代码的位置，这个时候可以使用以下命令打开文件
```
vim 文件名 +行数
```
提示：如果只带上`+`而不指定行号，会直接定位到**文件末尾**

### 异常处理

如果`vim`异常退出，在磁盘上可能会保存有交换文件，下次再使用`vim`编辑该文件时，会看到以下屏幕信息，按下字母`d`可以删除交换文件即可
提示：按下键盘时，注意关闭输入法

![](/img/IMG62.png)



## 工作模式
这里将在屏幕末行输入命令这种情况单独拿出来叫做末行模式，是为了后面比较容易讲解

vi 有以下基本工作模式：

1. **命令模式**
    - 打开文件首先进入命令模式，是使用`vim`的入口
    - 通过**命令**对文件进行常规的编辑操作，例如：定位、翻页、复制、粘贴、删除……
    - 在其他图形编辑器下，通过快捷键或者鼠标实现的操作，都在命令模式下实现
2. **末行模式** —— 执行 **保存**、**退出** 等操作
    - 要退出`vim`返回到控制台，需要在末行模式下输入命令
    - 末行模式是`vim` 的出口
3. **编辑模式** —— 正常的编辑文字

![](/img/IMG63.png)

使用`ESC`键从其他模式切换到命令模式，可以使用`CTRL+[`替代



## 末行模式命令
末行命令主要是针对文件进行操作的：保存、退出、保存&退出、搜索&替换、另存、新建、浏览文件

|命令|	英文|	功能|
|--|--|--|
|:w|	write	|保存|
|  :w filename| |  保存对文件的更改 |
|:q|	quit	|退出，如果没有保存，不允许退出|
|:q!|	quit	|强行退出，不保存退出|
|:wq|	write & quit	|保存并退出|
|:x	|	    |保存并退出|


### 文件相关命令

|命令	|英文|	功能|
|--|--|--|
|:e 文件名| edit| 打开一个新文件|
|:e .	|edit|	会打开内置的文件浏览器，浏览要当前目录下的文件|
|:n 文件名|	new	|新建文件|
|:w 文件名|	write|	另存为，但是仍然编辑当前文件，并不会切换文件|



提示：
- 切换文件之前，必须保证当前这个文件已经被保存！
- 在实际开发中，可以使用 w 命令 阶段性的备份代码


### 分屏命令
使用分屏命令，可以 同时编辑和查看多个文件

|命令|	英文|	功能|
|--|--|--|
|:sp [文件名] or :split |	split|	水平分割当前窗口|
|:vsp [文件名] or :vsplit|vertical split	|垂直分割当前窗口|
| :split file  | 在第二个窗口中打开该文件  |

#### 切换分屏窗口
分屏窗口都是基于`CTRL+W`这个快捷键的，`w`对应的英文单词是window

|命令|	英文	|功能|
|--|--|--|
|w	|window|	切换到下一个窗口|
|r|	reverse|	互换窗口|
|c|	close	|关闭当前窗口，但是不能关闭最后一个窗口|
|q|	quit	|退出当前窗口，如果是最后一个窗口，则关闭 vi|
|o|	other	|关闭其他窗口|
|n||拆分窗口并开始编辑新文件|
|方向键||在方向键方向的窗口之间切换|

#### 调整窗口大小
分屏窗口都是基于`CTRL+W`这个快捷键的，`w`对应的英文单词是window

|命令|	英文|	功能|
|--|--|--|
|+|		|增加窗口高度|
|-|		|减少窗口高度|
|>|		|增加窗口宽度|
|<|		|减少窗口宽度|
|=|		|等分窗口大小|
调整窗口宽高的命令可以和数字连用，例如：5 CTRL + W + 连续 5 次增加高度

<!-- |  窗口 |   |
|---|---|
| :n split file  |  打开一个新窗口n行高 |
| :new  |  水平打开一个新窗口 |
| :vnew  | 垂直打开一个新窗口  |
|  :res n |  如果未提供n，则将窗口大小调整为n行大小窗口大小调整为最大大小 | -->



<br>


## 常用命令
使用`vim`命令时，注意关闭中文输入法
`vim`的命令较多，不要期望一下子全部记住，个别命令忘记了只是会影响编辑速度而已





### 移动
`vim`之所以快，关键在于能够快速定位到要编辑的代码行，移动命令能够和编辑操作命令组合使用

在命令模式下样快速移动光标
#### 上、下、左、右

|命令	|功能|
|  --|--|
|  h or ← |  移动左侧的一个字符 |
| j or ↓ |  向下移动一行 |
|  k or ↑ |  向上移动一行 |
| l or →  |  向右移动一字符 |


#### 行内移动

|命令| 	英文|	功能|
|--|--|--|
|w	| word	|向后移动一个单词|
|b| 	back|	向前移动一个单词|
|0| 	|行首|
|^| 	|行首，第一个不是空白字符的位置|
|$| 	|行尾|


#### 行数移动

|命令|	英文|	功能|
|--|--|--|
|gg|	go|	文件顶部|
|G	|go|	文件末尾|
|数字gg|	go|	移动到 数字 对应行数|
|数字G|	go|	移动到 数字 对应行数|
|:数字|		|移动到 数字 对应行数|
| nk  |向上移动n行（向上移动9行->9k）|
| 5G | 移动到第五行 |

#### 屏幕移动

|命令	|英文|	功能|
|--|--|--|
|Ctrl + b|	back|	向上翻页|
|Ctrl + f|	forward|	向下翻页|
|H	|Head|	屏幕顶部|
|M|	Middle|	屏幕中间|
|L	|Low	|屏幕底部|

#### 段落移动
`vim` 中使用**空行**来区分段落
在程序开发时，通常**一段功能相关的代码会写在一起**————之间没有空行

|命令|	功能|
|--|--|
|{	|上一段|
|}	|下一段|


#### 括号切换
在程序世界中，()、[]、{} 使用频率很高，而且都是成对出现的


|命令	|功能|
|--|--|
|%	|括号匹配及切换|


#### 标记
在开发时，**某一块代码可能需要稍后处理**，例如：编辑、查看
此时先使用`m`增加一个标记，这样可以在**需要时快速地跳转回来**或者**执行其他编辑操作**
标记名称可以是`a~z`或者`A~Z`之间的任意一个字母
添加了标记的行如果被删除，标记同时被删除
如果在其他行添加了相同名称的标记，之前添加的标记也会被替换掉

|命令|	英文|	功能|
|--|--|--|
|mx|	mark	|添加标记 x，x 是 a~z 或者 A~Z 之间的任意一个字母|
|‘x|		|直接定位到标记 x 所在位置|

### 选中文本（可视模式）
学习复制命令前，应该先学会怎么样选中要复制的代码
在`vim`中要选择文本，需要先使用`Visual`命令切换到**可视模式**
`vim` 中提供了三种可视模式，可以方便程序员选择选中文本的方式
按`ESC`可以放弃选中，返回到`命令模式`

|命令|	模式	|功能|
|--|--|--|
|v	|可视模式	|从光标位置开始按照正常模式选择文本|
|V	|可视行模式|	选中光标经过的完整行|
|Ctrl + v|	可视块模式|	垂直方向选中文本|

可视模式下，可以和移动命令连用，例如：`ggVG`能够选中所有内容



### 编辑操作
删除、复制、粘贴、替换、缩排

#### 删除文本(剪切)

|命令|	英文|	功能|
|---|---|---|
|x	|cut|	删除光标所在字符，或者选中文字|
|d(移动命令)	|delete|	删除移动命令对应的内容|
|dd	|delete|	删除光标所在行，可以 ndd 复制多行|
|D	|delete|	删除至行尾|
| dw  | | 删除单词  |

如果使用**可视模式**已经选中了一段文本，那么无论使用`d`还是`x`，都可以删除选中文本


删除命令可以和移动命令连用，以下是常见的组合命令
```
dw        # 从光标位置删除到单词末尾
d0        # 从光标位置删除到一行的起始位置
d}        # 从光标位置删除到段落结尾
ndd       # 从光标位置向下连续删除 n 行
d代码行号G   # 从光标所在行删除到指定代码行之间的所有代码
d'a       # 从光标所在行删除到标记 a 之间的所有代码
```

### 撤销和恢复撤销
redo和undo相反

|命令|	英文	|功能|
|---|---|---|
|u	|undo|	撤销上次命令|
|  U |  |撤销对该行进行的所有最新更改 |
|CTRL + r|	redo|	恢复撤销的命令|



### 复制、粘贴

`vim`中提供有一个被复制文本的缓冲区
**复制** 命令会将选中的文字保存在缓冲区
**删除(剪切)** 命令删除的文字会被保存在缓冲区
在需要的位置，使用**粘贴**命令可以将缓冲区的文字插入到光标所在位置

|命令|	英文|功能|
|---|---|---|
|y(移动命令)|	copy|	复制|
|yy or Y |copy	|复制当前行，可以 nyy 复制多行|
|p	|paste|	粘贴|
| P | | 在光标位置之前粘贴文本，将行放在当前行的上方  |



**提示**
- 命令`d`、`x`类似于图形界面的 剪切操作————`CTRL+X`
- 命令`y`类似于图形界面的 复制操作————`CTRL+C`
- 命令`p`类似于图形界面的 粘贴操作————`CTRL+V`
- `vim` 中的文本缓冲区同样只有一个，如果后续做过复制、剪切 操作，之前缓冲区中的内容会被替换

**注意**
- `vim` 中的**文本缓冲区**和系统的**剪贴板**不是同一个
- 所以在其他软件中使用`CTRL+C`复制的内容，不能在`vim`中通过`P`命令粘贴
- 可以在编辑模式下使用鼠标右键粘贴
- 如果要使用系统剪贴板参考[这里](https://fengrenxiaoli.github.io/post/333f9b1a.html)


### 替换
替换命令的作用就是不用进入编辑模式，对文件进行轻量级的修改

|命令|	英文|	功能|	工作模式|
|--|--|--|--|
|r|	replace|	替换当前字符|	命令模式|
|R|	replace|	替换当前行光标后的字符|	替换模式|

`R`命令可以进入**替换模式**，替换完成后，按下`ESC`可以回到**命令模式**



### 缩排和重复执行
在命令模式下，先输入一个数字，再跟上一个命令，可以让该命令**重复执行指定次数**


|命令|	功能|
|--|--|
|>>	|向右增加缩进|
|<<	|向左减少缩进|
|.	|重复上次命令|


缩排命令在开发程序时，统一增加代码的缩进比较有用！
一次性在选中代码前增加 4 个空格，就叫做**增加缩进**
一次性在选中代码前删除 4 个空格，就叫做**减少缩进**
在**可视模式**下，缩排命令只需要使用 一个`>`或者`<`


在程序中，缩进通常用来表示**代码的归属关系**
- 前面空格越少，代码的级别越高
- 前面空格越多，代码的级别越低

### 查找
#### 常规查找

|命令	|功能|
|--|--|
|/str|	查找 str|
|?str|	向上查找 str|
|\vstr| str中的非字母数字字符被视为正则表达式特殊字符（不需转义字符）|
查找到指定内容之后，使用Next查找下一个出现的位置：
- `N`: 查找上一个
- `n`: 查找下一个
如果不想看到高亮显示，可以随便查找一个文件中不存在的内容即可

#### 单词快速匹配

|命令|	功能|
|--|--|
|*	|向后查找当前光标所在单词|
|#	|向前查找当前光标所在单词|

在开发中，通过单词快速匹配，可以快速看到这个单词在其他什么位置使用过


### 查找并替换
在`vim`中查找和替换命令需要在**末行模式**下执行



基本命令格式：
```
:%s///g
```
#### 全局替换
一次性替换文件中的所有出现的旧文本，命令格式如下：
```
:%s/旧文本/新文本/g
```

#### 可视区域替换
先**选中要替换文字**的范围，命令格式如下：
```
:s/旧文本/新文本/g
```


#### 确认替换
如果把末尾的`g`改成`gc`在替换的时候，会有提示！推荐使用！
```
:%s/旧文本/新文本/gc

y     yes 替换
n     no 不替换
a     all 替换所有
q     quit 退出替换
l     last 最后一个，并把光标移动到行首
^E    向下滚屏
^Y    向上滚屏
```

### 插入命令
在`vim`中除了常用的`i`进入**编辑模式**外，还提供了以下命令同样可以进入编辑模式：

|命令|	英文|	功能|
|--|--|--|
|i	|insert|	在当前字符前插入文本	|
|I	|insert|	在行首插入文本	|
|a	|append|	在当前字符后添加文本|	
|A	|append|	在行末添加文本|	
|o	|	|在当前行后面插入一空行	|
|O	|	|在当前行前面插入一空行|	

![](/img/IMG64.png)

































<!-- | 标签  |   |
|---|---|
| :tabnew  | 打开一个新标签  |
| gt  |  转到下一个选项卡 |
| gT  |  转到上一个标签 |
| :tabmove n  |  将标签移动到位置n |
|  :tabc |  关闭标签 | -->


<!-- |  Shell命令 |   |
|  --- |  --- |
| :shell  | 打开命令提示符  |
|  exit |  退出命令提示符 | -->






<!-- | 模式  |   |
|---|---|
|  ESC |   |
| i  | 插入模式  |
|  v | 可视模式，以字符为单位  |
| V  | 可视模式，以行为单位  | -->



<!-- |  缓冲 |   |
|---|---|
| :buffers  |  找到缓冲区列表 |
| :b number  |  选择缓冲区号码 |
| :sb number  |  拆分窗口并开始编辑缓冲区 |
|  :vertical sbuffer number  |  垂直分割窗口并编辑缓冲区 |
| :bnext or :bn  |  转到下一个缓冲区 |
| :bdelete  | 删除缓冲区而不保存  |

缓冲标志
i   非活动缓冲区   
h   隐藏缓冲区 
％  当前缓冲区 
＃  备用缓冲区 
+   文件已被修改 -->

<br>

参考
* https://www.cheatography.com/zoltan/cheat-sheets/basic-vim/
* https://vim.rtorr.com/lang/zh_cn/
* http://michael.peopleofhonoronly.com/vim/
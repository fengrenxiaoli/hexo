---
title: 计算机组成原理
abbrlink: 8d4b7ae1
date: 2018-06-16 12:30:31
tags:
---

以下为哈尔滨理工大学的[计算机组成原理](https://www.icourse163.org/course/HIT-309001#/info)笔记
使用的教材是唐朔飞的《计算机组成原理》

## 总述

### 内容
1. 基本部件的结构和组织方式
2. 基本运算的操作原理
3. 基本部件和单元的设计思想

 

### 教材
1. 唐朔飞. **计算机组成原理**（第2版）.高等教育出版社
2. David A.Patterson. John L.Hennessy. Computer Organization & Design: A Hardware/Software Interface(**计算机组成与设计：硬件/软件接口**)
3. David Harris, Sarah Harris. Digital Design and Computer Architecture. Morgan Kaufmann, 2007(**数字设计和计算机系结构**)



<!--more-->

### 结构
![](/img/CO001.png)
![](/img/CO002.png)


## 概论
### 计算机系统简介
#### 计算机的软硬件
计算机系统
- 硬件：计算机的实体
- 软件：由具有各类特殊功能的信息程序组成
  - 系统软件：管理整个计算机系统，监视服务，使系统资源得到合理调度，高效运行，包括标准程序库、语言处理程序、操作系统、服务程序、数据库管理系统、网络软件
  - 应用软件：用户根据任务需要所编制的各种程序


计算机组成原理主要是讲硬件

#### 计算机系统的层次结构

应对系统复杂性的方法 
- 抽象 
- 层次化（Hierachy）：将被设计的系统划分为多个模块或子模块
- 模块化（Modularity）：有明确定义 （well-defined）的功能和接口
- 规则性（regularity）：模块更容易被重用 

<!-- 以下为对计算机软硬件的抽象，计算机组成原理主要研究逻辑层和微体系结构层
![](/img/CO006.png) -->


![](/img/CO007.png)

M0和M1都是实际机器，M2（操作系统）以上都是虚拟机。硬件主要研究M0和M1，软件主要研究M2以上
计算机组成原理主要研究微指令层和机器语言层，

翻译程序
将高级语言程序翻译成机器语言程序的软件称为翻译程序。
- 编译程序：将用户编写的高级语言程序（源程序）的全部语句一次全部翻译成机器语言程序，而后再执行机器语言程序。只要源程序不变，就无须再次进行翻译。
- 解释程序：将源程序的一条语句翻译成对应于机器语言的一条语句，并且立即执行这条语句，接着翻译源程序的下一条语句，并执行这条语句，如此重复直至完成源程序的全部翻译任务。翻译一次执行一次，即使下一次重复执行该语句时，也必重新翻译。

每一条机器指令翻译成一组微指令，即构成一个微程序

#### 计算机组成和计算机体系结构

计算机体系结构描述程序员所见到的计算机系统的属性，概念性的结构与功能特性，包括指令系统、数据类型、寻址技术、I/O机理
计算机组成描述如何实现计算机体系结构所体现的属性，即具体指令的实现

计算机体系结构规定了软件和硬件的接口，哪些功能应该由软件实现，哪些由硬件实现
计算机组成则是根据体系结构规定的硬件实现的要求，使用哪些元件，什么样的物理结构来实现
也就是说，体系结构像指挥官，告诉组成去实现哪些指令
所以，从另一个角度，也就是程序员的角度来思考，就是体系结构是面向程序员的，他可以使用什么样的指令进行编程，来实现想要的功能，体系结构向上屏蔽了硬件实现细节，比如说实现寄存器0与寄存器1的数值相加，程序员知道这台机器提供了这样的指令，直接用来编程即可，具体是使用什么样的元件，什么样的连接，并不关心，只要有这样的功能就好了，这样的抽象，很大程度上屏蔽了复杂性；计算机组成则更多的是面向硬件工程师，要考虑采用什么样的元件来实现，如何提升效率，还要考虑电气特性等等

### 计算机的基本组成 

冯·诺依曼计算机的特点 
1. 计算机由运算器、存储器、处理器、输入设备和输出设备五大部件组成 
2. 指令和数据以同等地位存于存储器，可按地址寻访
3. 指令和数据均用二进制表示
4. 指令由操作码和地址码组成，操作码用来表示操作的性质，地址码用于表示操作数在存储器中的位置
5. **存储程序**，指令在存储器内按顺序存放
6. 以运算器为中心 

哈佛结构是将数据和指令分开存储的结构

![](/img/CO003.png)

运算器：算术运算、逻辑运算 
控制器：指挥程序运行 
存储器：存放数据和程序
输入设备：将信息转换成机器能识别的形式
输出设备：将结果转换成人们熟悉的形式



运算器是瓶颈，改进：以存储器为中心的结构
![](/img/CO004.png)



现代计算机结构

![](/img/CO005.png)

#### 计算机的工作过程

![](/img/CO008.png)

1.主存储器（内存）
包括存储体和2个寄存器

**存储体M**包括多个**存储单元**，每个存储单元包括多个**存储元件**，每个存储元件存储一位二进制1或0
存储单元存放的一串二进制代码称为**存储字**，这串二进制代码的长度称为**存储字长**
每个存储单元都有一个编号，称为存储单元的**地址号**
主存的工作方式就是按存储单元的地址号来实现对存储字各位的写入和读出，这种存取方式称为**按地址存取方式**，简称访存

![](/img/CO009.png)

寄存器：
- MAR：Memory Address Register，存储器地址寄存器，存放地址，其位数对应存储单元的个数，反映了能存多少个地址
- MDR：Memory Data Register，存储器数据寄存器，存放数据，其位数与存储字长相等，反映了能存多在的数据




2.运算器
包括3个寄存器和一个算术逻辑单元

算术逻辑单元，Arithmetic Logic Unit，ALU，算术逻辑运算

寄存器包括ACC累加器，MQ乘商寄存器，X操作数寄存器

![](/img/CO010.png)



3.控制器

控制器用于解释指令，并保证指令的按序执行。解释指令的过程包括取指过程、分析过程、执行过程 

控制器包括程序计数器PC、指令寄存器IR、控制单元CU
- PC：取指，存放当前欲执行指令的地址，具有计数功能(PC)+1->PC，即自动形成下一条指令的地址
- IR：分析，存放当前欲执行的指令，OP(IR)指操作码，Ad(IR)指地址码
- CU：执行指令


一条指令在主机上的完成过程
![](/img/CO011.png)
1. PC存放程序的首地址，控制器将PC中的地址送至主存的MAR
2. MAR读取存储体中的地址
3. 将存储体中读到的内容送入MDR
4. MDR将内容送到IR
5. CU分析IR的操作码，当前操作码为取数指令
6. CU控制IR的地址码送入MAR
7. MAR读取存储体中的地址
8. 将存储体中读到的内容送入MDR
9. MDR将数据送入ACC累加器

![](/img/CO012.png)



程序在主机上是如何执行的
![](/img/CO013.png)

### 计算机硬件的主要技术指标

#### 机器字长
CPU一次能处理数据的位数，与 CPU 中的寄存器位数有关
机器字长，指令字长和存储字长可以相等也可以不等。

#### 运算速度 
1. 主频/时钟频率：CPU内部晶振的频率，常用单位为MHz，它反映了CPU的基本工作节拍
2. 时钟周期：主频的倒数，t =1/ f
3. 机器周期：一个机器周期包含若干个时钟周期，m*t
4. 核数,每个核支持的线程数
5. 吉普森法，每条指令的加权平均执行时间，根据计算百分比方法的不同分为静态（直接计算百分比）和动态（实际运行计算百分比）方法
6. CPI，平均每条指令的平均时钟周期个数，m*n
7. 指令周期：执行一条指令所需要的时间，一般包含若干个机器周期，指令周期 = m*t*n = CPI×机器周期
8. MIPS：每秒执行百万条指令数， MIPS  = 1/（CPI×时钟周期）= 主频/CPI
9. FLOPS 每秒浮点运算次数，PFLOPS、MFLOPS

题： 若某处理器的时钟频率为500MHz，每4个时钟周期组成一个机器周期，执行一条指令需要3个机器周期，则该处理器的一个机器周期 8 ns，平均执行速度为 42 MIPS

解析如下：
时钟周期T等于主频的倒数，即T=1/500MHz=1/（0.5×10的9次方Hz）=2 ns，机器周期等于4个时钟周期即=4T=4×2 ns=8 ns，每条指令的时钟周期数CPI=3×4=12，则平均速度为：f/（CPI×10的6次方）=（500×10的6次方）/（12×10的6次 方）=500/12=41.6≈42MIPS.计算主频的倒数时要注意把主频的MHz换算成Hz即500后面加6个0=500×10的6次方=0.5×10的9次方，1/10的9次方 Hz=1ns

每条指令的时钟周期数CPI=3×4=12，执行一条指令需要3个机器周期数，一个机器周期包含4个时钟周期，所以CPI=3×4=12，这里计算 的都是周期的个数，和具体的时间ns纳秒没有关系，若带上具体的时间，一个时钟周期T=2ns，一个机器周期就是2×4=8ns，执行一条指令需要三个机 器周期得出执行一条指令需要的具体时间为3×8=24ns，执行每条指令的需要的时钟周期数CPI换句话说就是把执行每条指令需要的时间24ns换算成时 钟周期个数表示，为多少个时钟周期个数?时钟周期是最基本的时间操作单位，500MHz主频的处理器一个时钟周期为2ns，24ns等于多少个时钟周期？24/2=12个时钟周期，即那一句：“每条指令的时钟周期数CPI=12”。


#### 存储容量
存放二进制信息的总位数

![](/img/CO014.png)
<!-- 1. 主存容量
  - 存储单元个数 × 存储字长，2^MAR × MDR 位
  - 字节数：2^13b= 1KB，2^21b= 256KB，1B = 2^3b
2. 辅存容量，用字节数来表示，80GB（1GB = 2^30B） -->


## 硬件结构
计算机硬件系统由中央处理器、存储器、I/O系统以及连接它们的系统总线组成
### 总线
计算机系统五大部件之间的互边连方式包括：
1. 分散连接：各部件之间使用单独的连线，不利于扩展设备
2. 总线连接：将各部件连到一组公共信息传输线上


#### 总线的基本概念

总线是连接各个部件的信息传输线，是各个部件共享的传输介质
在某一时刻只允许一个部件向总线发送信息



#### 总线的分类
按照连接部件的不同，分为
1. 片内总线：芯片内部的总线（片外总线不叫片外总线），CPU芯片内部、寄存器之间、寄存器与ALU之间
2. 系统总线：CPU、主存、I/O设备之间的信息传输线，按系统总线传输信息的不同分为：
  - 数据总线：双向 与机器字长、存储字长有关（小于等于）
  - 地址总线：单向，由CPU输出 与存储地址、 I/O地址有关
  - 控制总线：用来发出各种控制信号的传输线，从CPU输出（存储器读、存储器写、总线允许、中断确认）或输入（中断请求、总线请求）
3. 通信总线：用于计算机系统之间或计算机系统与其他系统(如控制仪表、移动通信等)之间的通信，按传输方式分为
  - 串行通信总线：数据在单条1位宽的传输线上，一位一位地按顺序分时传送。适用于远距离传送
  - 并行通信总线：数据在多条并行1位宽的传输线上同时由源传送到目的地。。适用于近距离传送


并行传输因为互相干扰，所以传输距离短

串行传输和并行传输的优缺点： 
1. 串行传输 
  - 优点：使用的数据线少，在远距离通信中可以节约通信成本。 
  - 缺点：因为每次只能传输一位数据，所以传输速度比较低。 
2. 并行传输 
  - 优点：因为可以多位数据一起传输，所以传输速度很快。 
  - 缺点：内存有多少位，就要用多少数据线，所以需要大量的数据线，成本很高。

#### 总线特性

1. 机械特性：尺寸、形状、管脚数 及 排列顺序
2. 电气特性：传输方向和有效的电平范围
3. 功能特性：每根传输线的功能，地址、数据、控制
4. 时间特性：信号的时序关系，总线中的任一根线在什么时间内有效


#### 性能指标
1. 总线宽度：数据总线的根数，总线能同时传送的二进制数据的位数，总线宽度越宽，每秒钟数据传输率越大，总线的带宽越宽。 
2. 标准传输率/总线带宽：单位时间内总线上传送的数据量，每秒传输的最大字节数(MBps，兆字节每秒)，总线的带宽＝总线的工作频率×总线宽度/8
3. 时钟同步/异步：同步（总线上的数据与时钟同步工作）、不同步（不同步包括异步）
4. 总线复用：一条信号线上分时传送两种信号，地址线与数据线复用，可以减少总线中信号线的数量、引脚的数量
5. 信号线数：地址总线、数据总线和控制总线的总和
6. 总线控制方式：突发、自动、仲裁、逻辑、计数
7. 其他指标：负载能力


<!-- 
总线的带宽（总线数据传输速率）
总线的带宽指的是，即每秒钟传送MB的最大稳态数据传输率。与总线带宽密切相关的两个因素是总线的位宽和总线的工作频率，它们之间的关系：**总线的带宽＝总线的工作频率×总线的位宽/8**。 

总线的位宽
总线的位宽指的是总线能同时传送的二进制数据的位数，或数据总线的位数，即32位、64位等总线宽度的概念。总线的位宽越宽，每秒钟数据传输率越大，总线的带宽越宽。  -->

总线的工作频率
总线的工作时钟频率以MHz为单位，工作频率越高，总线工作速度越快，总线带宽越宽。

#### 总线标准

系统与各模块、模块与模块之间的一个互连的标准界面

![](/img/CO018.png)


#### 总线结构
总线结构的改进总是按照**解决瓶颈**、**功能分离**、**区分高速和低速**的思路递进


##### 单总线结构
![](/img/CO016.png)
所有的设备都连接在一条系统总线上
I/O设备和主存交换信息不必经过cup，减轻cpu负担
CPU和主存之间交互需要经过总线，加大总线负担
更容易发生冲突，需要设置总线判优逻辑，影响整机的工作效率

##### 双总线结构
将速度较低的I/O设备从单总线上分离出来
![](/img/CO019.png)
通道是一个具有特殊功能的处理器，由通道对I/O统一管理

![](/img/CO015.png)
以CPU为中心，发出存储总线和I/O总线，分别连接主存和I/O设备。
CPU和主存之间交互频繁单有单独总线，提高效率
I/O设备与主存交换信息时仍然要占用CPU，影响CPU的工作效率

![](/img/CO017.png)
在单总线基础上加一条CPU和主存之间的总线。或者说面向CPU双总线结构基础上在主存连接到了I/O总线
CPU和主存之间可以直接交换信息。
I/O和主存之间交换信息也不用经过CPU。

##### 三总线结构
将速率不同的I/O设备进行分类

![](/img/CO020.png)
任一时刻只能使用一种总线

![](/img/CO021.png)

##### 四总线结构
将速度更快的接口从扩展总线接口分离
![](/img/CO022.png)

举例
![](/img/CO023.png)
![](/img/CO024.png)
![](/img/CO025.png)

#### 总线控制
使用总线需要解决两个问题，判优控制（总线同一时刻只允许一个部件发送信息）和通信问题（保证传输的正确性）

##### 总线判优控制
通过总线判优控制获得总线使用权，只有获得总线使用权的主设备才能开始传送数据

总线上所连接的各类设备按其对总线有无控制功能可分为主设备和从设备
- 主设备(模块) 对总线有控制权，发出总线请求
- 从设备(模块) 响应从主设备发来的总线命令

总线判优控制分为
- 集中式
  - 链式查询：3根用于总线控制
  - 计数器定时查询：计数器可以定义为0、上次执行的接口、或者某个k，优先级根据计数器的初始值设定，大致用log2(n)根线
  - 独立请求：每一台设备均有一对总线请求线BR和总线同意线BG，2n根线，排队器设定优先级
- 分布式

![](/img/CO026.png)
![](/img/CO027.png)
![](/img/CO028.png)

##### 总线通信控制
解决通信双方协调配合问题

总线传输周期：
1. 申请分配阶段 主模块申请，总线判优决定
2. 寻址阶段 主模块向从模块 给出地址和命令
3. 传数阶段 主模块和从模块交换数据
4. 结束阶段 主模块撤消有关信息


总线通信的四种方式
1. 同步通信：由统一时标控制数据传送，一般用于总线长度较短、各部件存取时间比较一致的场合
2. 异步通信：采用应答方式，没有公共时钟标准，分为不互锁、半互锁和全互锁
  - 不互锁：主模块不必等待接到从模块的回答信号，从模块不必等待接到主模块的回答信号
  - 半互锁：主模块必须待接到从模块的回答信号后再撤销其请求信号，从模块不必等待接到主模块的回答信号
  - 全互锁：主模块必须待接到从模块的回答信号后再撤销其请求信号，从模块必须待接到主模块的回答信号后再撤销其请求信号
3. 半同步通信：同步（发送方用系统时钟前沿发信号，接收方用系统时钟后沿判断、识别）、异步（允许不同速度的模块和谐工作）结合，增加一条 “等待”响应信号WAIT
4. 分离式通信：充分挖掘系统总线每个瞬间的潜力，总线上所有模块都可以成为主模块

![](/img/CO029.png)
![](/img/CO030.png)
![](/img/CO031.png)
![](/img/CO032.png)


一个总线传输周期(以输入数据为例)
1. 主模块发地址、命令   占用总线
2. 从模块准备数据       不占用总线 总线空闲
3. 从模块向主模块发数据  占用总线

分离式通信改进一个总线传输周期，各模块准备数据时，不占用总线
1. 子周期1：主模块申请占用总线，使用完后即放弃总线的使用权
2. 子周期2：从模块申请占用总线，将各种信息送至总线上

分离式通信特点
1. 各模块有权申请占用总线
2. 采用同步方式通信，不等对方回答（同步通信主模块不用等待从模块是否得到响应，可以缩短各个设备的数据传送时间，实现高速度、大容量的数据传送。）
3. 各模块准备数据时，不占用总线
4. 总线被占用时，无空闲
充分提高了总线的有效占用


### 存储器

存储器的分类


存储器的层次结构



#### 主存储器



#### 调整缓冲存储器



#### 辅助存储器





### 输入输出系统

## 中央处理器CPU

## 控制单元CU




































































